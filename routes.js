const a0_0x407d76=a0_0x5674;(function(_0x2b2328,_0x2673fc){const _0x5309de=a0_0x5674,_0x3e2270=_0x2b2328();while(!![]){try{const _0x3a35c5=parseInt(_0x5309de(0x1ef))/0x1*(parseInt(_0x5309de(0x1b8))/0x2)+-parseInt(_0x5309de(0x1a7))/0x3+parseInt(_0x5309de(0x1dd))/0x4+-parseInt(_0x5309de(0x1fb))/0x5+parseInt(_0x5309de(0x1e8))/0x6+parseInt(_0x5309de(0x1b1))/0x7*(parseInt(_0x5309de(0x1b0))/0x8)+parseInt(_0x5309de(0x225))/0x9*(parseInt(_0x5309de(0x209))/0xa);if(_0x3a35c5===_0x2673fc)break;else _0x3e2270['push'](_0x3e2270['shift']());}catch(_0x2f9774){_0x3e2270['push'](_0x3e2270['shift']());}}}(a0_0x278a,0xd285c),require('dotenv')[a0_0x407d76(0x1ff)]());const express=require(a0_0x407d76(0x1ed)),upload=require(a0_0x407d76(0x221)),db=require(a0_0x407d76(0x1a6)),bcrypt=require(a0_0x407d76(0x1db)),crypto=require(a0_0x407d76(0x208)),{promisify}=require(a0_0x407d76(0x1aa)),fs=require('fs'),path=require(a0_0x407d76(0x1e6)),logger=require('./logger'),readFile=promisify(fs[a0_0x407d76(0x1ae)]),unlink=promisify(fs[a0_0x407d76(0x1e4)]),router=express[a0_0x407d76(0x1e5)](),config={'debug':process[a0_0x407d76(0x1a0)]['DEBUG']===a0_0x407d76(0x1ea)};console[a0_0x407d76(0x1f3)](a0_0x407d76(0x1dc)+config['debug']);const handleError=(_0x3ceb4b,_0x590892,_0x1daf66)=>{const _0x562b00=a0_0x407d76;return config[_0x562b00(0x1da)]?(logger[_0x562b00(0x1b2)](_0x1daf66+':\x20'+_0x590892[_0x562b00(0x1bb)]),_0x3ceb4b[_0x562b00(0x1a3)](0x1f4)[_0x562b00(0x1bf)]({'error':_0x1daf66,'stack':_0x590892['stack']})):(logger[_0x562b00(0x1b2)](_0x1daf66+':\x20'+_0x590892[_0x562b00(0x1ba)]),_0x3ceb4b['status'](0x1f4)[_0x562b00(0x1bf)]({'error':_0x1daf66}));},isValidEmail=_0x755c42=>{const _0x2f2a04=a0_0x407d76,_0xfbb1f8=_0x755c42[_0x2f2a04(0x1fe)]('@');if(_0xfbb1f8===-0x1)return![];const _0x586423=_0x755c42['slice'](0x0,_0xfbb1f8),_0xc0963e=_0x755c42[_0x2f2a04(0x19e)](_0xfbb1f8+0x1);return _0x586423[_0x2f2a04(0x1ad)]<=0x40&&_0xc0963e['length']<=0xff;},isAuthenticated=(_0xe31a17,_0x383f41,_0x363df0)=>{const _0x5ef6a9=a0_0x407d76;if(_0xe31a17[_0x5ef6a9(0x1d5)][_0x5ef6a9(0x215)])return _0x363df0();_0x383f41['status'](0x191)[_0x5ef6a9(0x1bf)]({'error':_0x5ef6a9(0x196)});},isAdmin=(_0xdb794a,_0x207112,_0x58c84d)=>{const _0x13d993=a0_0x407d76;if(!_0xdb794a['session'][_0x13d993(0x215)])return _0x207112[_0x13d993(0x1a3)](0x191)[_0x13d993(0x1bf)]({'error':_0x13d993(0x196)});const _0x19345d='SELECT\x20r.name\x20FROM\x20user_roles\x20ur\x20JOIN\x20roles\x20r\x20ON\x20ur.role_id\x20=\x20r.id\x20WHERE\x20ur.user_id\x20=\x20?';db['query'](_0x19345d,[_0xdb794a[_0x13d993(0x1d5)][_0x13d993(0x215)]['id']],(_0x33ee55,_0x3abb00)=>{const _0x171b63=_0x13d993;if(_0x33ee55||_0x3abb00[_0x171b63(0x1ad)]===0x0||!_0x3abb00[_0x171b63(0x1c2)](_0x347641=>_0x347641[_0x171b63(0x1df)]===_0x171b63(0x1e9)))return _0x207112[_0x171b63(0x1a3)](0x193)[_0x171b63(0x1bf)]({'error':_0x171b63(0x1f0)});_0x58c84d();});},validateFile=async(_0x1ca609,_0x4215b1,_0x155c06)=>{const _0x1e03bd=a0_0x407d76;if(!_0x1ca609['file'])return _0x4215b1['status'](0x190)[_0x1e03bd(0x1bf)]({'error':_0x1e03bd(0x1d6)});try{const _0x51ead6=await fs[_0x1e03bd(0x1de)][_0x1e03bd(0x1ae)](_0x1ca609['file'][_0x1e03bd(0x1e6)]),{fileTypeFromBuffer:_0x49fb95}=await import(_0x1e03bd(0x214)),_0x52145f=await _0x49fb95(_0x51ead6),_0x46b987=[_0x1e03bd(0x1a8),_0x1e03bd(0x204)];if(!_0x52145f||!_0x46b987[_0x1e03bd(0x20f)](_0x52145f[_0x1e03bd(0x1c8)]))return await unlink(_0x1ca609[_0x1e03bd(0x1eb)][_0x1e03bd(0x1e6)]),_0x4215b1[_0x1e03bd(0x1a3)](0x190)[_0x1e03bd(0x1bf)]({'error':_0x1e03bd(0x1c4)});_0x155c06();}catch(_0x4afeaf){return handleError(_0x4215b1,_0x4afeaf,'Error\x20validating\x20file.');}};router[a0_0x407d76(0x1c5)](a0_0x407d76(0x1b4),upload[a0_0x407d76(0x195)](a0_0x407d76(0x200)),validateFile,async(_0x53b1b3,_0x55d4c5)=>{const _0x31779e=a0_0x407d76,{full_name:_0xca3e2d,emailsignup:_0x3bc4e1,phone_number:_0x323528,passwordsignup:_0x1db35e,confirmpassword:_0x54056d}=_0x53b1b3[_0x31779e(0x21b)],_0x1a1d04=_0x53b1b3[_0x31779e(0x1eb)]?_0x53b1b3[_0x31779e(0x1eb)]['path']:null;if(!isValidEmail(_0x3bc4e1))return _0x55d4c5[_0x31779e(0x1a3)](0x190)['json']({'error':_0x31779e(0x217)});const _0xf3277a=/^(?=.*[A-Za-z])(?=.*\d)(?=.*[\W]).{12,64}$/;if(!_0xf3277a[_0x31779e(0x218)](_0x1db35e))return _0x55d4c5[_0x31779e(0x1a3)](0x190)[_0x31779e(0x1bf)]({'error':'Password\x20must\x20include\x20uppercase,\x20lowercase\x20letters,\x20digits,\x20special\x20characters,\x20and\x20be\x2012-64\x20characters\x20long.'});if(_0x1db35e!==_0x54056d)return _0x55d4c5[_0x31779e(0x1a3)](0x190)['json']({'error':_0x31779e(0x1ec)});try{const _0xc5859=await bcrypt[_0x31779e(0x1d0)](_0x1db35e,0xa),_0x3d42a7=_0x31779e(0x1d8);db['query'](_0x3d42a7,[_0xca3e2d,_0x3bc4e1,_0x323528,_0xc5859,_0x1a1d04],(_0x6719d1,_0xcf72b2)=>{const _0xec2311=_0x31779e;if(_0x6719d1)return _0x6719d1[_0xec2311(0x203)]===_0xec2311(0x1c9)?(logger[_0xec2311(0x1f6)](_0xec2311(0x1fa)+_0x3bc4e1),_0x55d4c5[_0xec2311(0x1a3)](0x190)[_0xec2311(0x1bf)]({'error':_0xec2311(0x1f4)})):handleError(_0x55d4c5,_0x6719d1,_0xec2311(0x1a5));const _0x39477f=_0xcf72b2[_0xec2311(0x19b)],_0x5adf5f=_0xec2311(0x212);db[_0xec2311(0x199)](_0x5adf5f,[_0x39477f],_0x390a2c=>{const _0x13586a=_0xec2311;if(_0x390a2c)return handleError(_0x55d4c5,_0x390a2c,_0x13586a(0x1b6));logger[_0x13586a(0x1f5)](_0x13586a(0x190)+_0x3bc4e1),_0x55d4c5[_0x13586a(0x1a3)](0xc8)[_0x13586a(0x1bf)]({'message':'Signed\x20up\x20successfully.'});});});}catch(_0x15a015){return handleError(_0x55d4c5,_0x15a015,_0x31779e(0x207));}}),router['post']('/login',trackLoginAttempts,async(_0x59554e,_0x2cc978)=>{const _0x1b45d8=a0_0x407d76,{email:_0x57712c,password:_0x36d984}=_0x59554e[_0x1b45d8(0x21b)];if(!_0x57712c||!_0x36d984)return _0x2cc978[_0x1b45d8(0x1a3)](0x190)[_0x1b45d8(0x1bf)]({'error':'Email\x20and\x20password\x20are\x20required.'});try{const _0x5920f5=_0x1b45d8(0x1ee);db['query'](_0x5920f5,[_0x57712c],async(_0x2420cd,_0x5bee60)=>{const _0x52818a=_0x1b45d8;if(_0x2420cd)return handleError(_0x2cc978,_0x2420cd,_0x52818a(0x1a1));if(_0x5bee60[_0x52818a(0x1ad)]===0x0)return handleFailedLoginAttempt(_0x59554e,_0x2cc978);const _0x3eef76=_0x5bee60[0x0],_0x33aa12=await bcrypt[_0x52818a(0x213)](_0x36d984,_0x3eef76[_0x52818a(0x1d1)]);if(!_0x33aa12)return handleFailedLoginAttempt(_0x59554e,_0x2cc978);renewSession(_0x59554e,_0x2cc978,async _0x65b7b6=>{const _0xbfb5d=_0x52818a;if(_0x65b7b6)return handleError(_0x2cc978,_0x65b7b6,'Error\x20renewing\x20session.');_0x59554e[_0xbfb5d(0x1d5)][_0xbfb5d(0x215)]={'id':_0x3eef76['id'],'email':_0x3eef76[_0xbfb5d(0x197)],'full_name':_0x3eef76[_0xbfb5d(0x1cf)]},_0x59554e[_0xbfb5d(0x1d5)][_0xbfb5d(0x1c0)]=Date[_0xbfb5d(0x1a9)]();const _0x2b4e0d=_0xbfb5d(0x1ce);db[_0xbfb5d(0x199)](_0x2b4e0d,[_0x3eef76['id'],_0x59554e[_0xbfb5d(0x20e)]],_0x3b78eb=>{const _0x384a75=_0xbfb5d;if(_0x3b78eb)return handleError(_0x2cc978,_0x3b78eb,_0x384a75(0x1f2));const _0x11e864=_0x384a75(0x20d);db['query'](_0x11e864,[_0x3eef76['id']],(_0x2d51ce,_0x475744)=>{const _0x1ef8b4=_0x384a75;if(_0x2d51ce)return handleError(_0x2cc978,_0x2d51ce,_0x1ef8b4(0x1a2));const _0x5939c0=_0x475744['map'](_0x174a68=>_0x174a68[_0x1ef8b4(0x1df)]);_0x59554e[_0x1ef8b4(0x1d5)][_0x1ef8b4(0x1f7)]=_0x5939c0,logger[_0x1ef8b4(0x1f5)](_0x1ef8b4(0x1e7)+_0x57712c),_0x2cc978[_0x1ef8b4(0x1a3)](0xc8)[_0x1ef8b4(0x1bf)]({'message':_0x1ef8b4(0x1e1),'sessionId':_0x59554e[_0x1ef8b4(0x20e)],'roles':_0x5939c0});});});});});}catch(_0x3db8e2){return handleError(_0x2cc978,_0x3db8e2,_0x1b45d8(0x1e0));}}),router[a0_0x407d76(0x191)](a0_0x407d76(0x1cb),isAuthenticated,(_0x1d19cd,_0x239fdd)=>{const _0x4271c3=a0_0x407d76;try{const _0x1ed284=_0x1d19cd[_0x4271c3(0x1d5)][_0x4271c3(0x215)]['id'],_0x49208e=_0x4271c3(0x222);db[_0x4271c3(0x199)](_0x49208e,(_0x1563b1,_0x569fb1)=>{const _0x15ba6a=_0x4271c3;if(_0x1563b1)return handleError(_0x239fdd,_0x1563b1,_0x15ba6a(0x1b5));_0x239fdd[_0x15ba6a(0x1bf)]({'currentUserId':_0x1ed284,'posts':_0x569fb1});});}catch(_0x4a9e88){return handleError(_0x239fdd,_0x4a9e88,'Error\x20fetching\x20posts');}}),router['post']('/posts',isAuthenticated,(_0x2c1f37,_0x12644e)=>{const _0x496227=a0_0x407d76;try{const {content:_0x26e1e3,price:_0x433d73,quantity:_0x5eb52d,status:_0x14369f}=_0x2c1f37[_0x496227(0x21b)];if(!_0x26e1e3||!_0x433d73||!_0x5eb52d||!_0x14369f)return logger['error']('Invalid\x20post\x20data:',_0x2c1f37['body']),_0x12644e['status'](0x190)[_0x496227(0x1ab)](_0x496227(0x211));const _0x1d570e=_0x496227(0x19f);db[_0x496227(0x199)](_0x1d570e,[_0x2c1f37[_0x496227(0x1d5)][_0x496227(0x215)]['id'],_0x26e1e3,_0x433d73,_0x5eb52d,_0x14369f],(_0x13cb3c,_0x583bd2)=>{const _0x3617da=_0x496227;if(_0x13cb3c)return logger[_0x3617da(0x1b2)]('Database\x20error:',_0x13cb3c),handleError(_0x12644e,_0x13cb3c,'Database\x20query\x20error');const _0x4988cc=_0x3617da(0x1c1);db['query'](_0x4988cc,[_0x2c1f37[_0x3617da(0x1d5)][_0x3617da(0x215)]['id']],(_0x8dc2c9,_0x4896a3)=>{const _0xf936b5=_0x3617da;if(_0x8dc2c9)return handleError(_0x12644e,_0x8dc2c9,_0xf936b5(0x1b5));const _0x58e88e=_0x4896a3[0x0][_0xf936b5(0x1d2)];_0x12644e[_0xf936b5(0x1bf)]({'message':_0xf936b5(0x1fd),'postId':_0x583bd2[_0xf936b5(0x19b)],'username':_0x58e88e}),logger[_0xf936b5(0x1f5)](_0xf936b5(0x1d9)+_0x58e88e);});});}catch(_0x456ed7){return handleError(_0x12644e,_0x456ed7,_0x496227(0x220));}}),router[a0_0x407d76(0x1f9)](a0_0x407d76(0x1c3),isAuthenticated,isAdmin,(_0x4331a2,_0x11d3fc)=>{const _0x43001f=a0_0x407d76;try{const {id:_0x2f9a2a}=_0x4331a2[_0x43001f(0x1e3)],{content:_0x657fc1,price:_0x56b58d,quantity:_0x49aa28,status:_0x5f0e7a}=_0x4331a2[_0x43001f(0x21b)],_0x3eff3c=_0x43001f(0x1f1);db['query'](_0x3eff3c,[_0x657fc1,_0x56b58d,_0x49aa28,_0x5f0e7a,_0x2f9a2a],(_0xce132e,_0x2d87d6)=>{const _0x517709=_0x43001f;if(_0xce132e)return handleError(_0x11d3fc,_0xce132e,_0x517709(0x1b5));_0x11d3fc[_0x517709(0x1bf)]({'message':_0x517709(0x21c)});});}catch(_0x1d35d7){return handleError(_0x11d3fc,_0x1d35d7,_0x43001f(0x1b9));}}),router['delete'](a0_0x407d76(0x1c3),isAuthenticated,isAdmin,(_0x3bd4cb,_0x3e6313)=>{const _0x30c9fe=a0_0x407d76;try{const {id:_0x42186e}=_0x3bd4cb[_0x30c9fe(0x1e3)],_0x3a10ad=_0x30c9fe(0x1c7);db[_0x30c9fe(0x199)](_0x3a10ad,[_0x42186e],(_0x22bda7,_0x556aff)=>{const _0x5dc394=_0x30c9fe;if(_0x22bda7)return handleError(_0x3e6313,_0x22bda7,'Database\x20query\x20error');_0x3e6313[_0x5dc394(0x1bf)]({'message':'Post\x20deleted\x20successfully'});});}catch(_0x5f58c8){return handleError(_0x3e6313,_0x5f58c8,'Error\x20deleting\x20post');}}),router[a0_0x407d76(0x1f9)](a0_0x407d76(0x1fc),isAuthenticated,(_0x489443,_0x2c91cf)=>{const _0x2c09d2=a0_0x407d76;try{const {id:_0x50a74b}=_0x489443[_0x2c09d2(0x1e3)],{status:_0x4df0e4}=_0x489443[_0x2c09d2(0x21b)],_0x38fddb=_0x2c09d2(0x1bd);db['query'](_0x38fddb,[_0x4df0e4,_0x50a74b],(_0xc9bc1c,_0x5409d0)=>{const _0x30852b=_0x2c09d2;if(_0xc9bc1c)return handleError(_0x2c91cf,_0xc9bc1c,_0x30852b(0x1b5));_0x2c91cf[_0x30852b(0x1bf)]({'message':_0x30852b(0x1d7)});});}catch(_0x4b4b42){return handleError(_0x2c91cf,_0x4b4b42,'Error\x20updating\x20post\x20status');}});const isUserPage=(_0x15b298,_0x18dd1c,_0x45e438)=>{const _0x565183=a0_0x407d76;if(!_0x15b298[_0x565183(0x1d5)][_0x565183(0x215)])return _0x18dd1c[_0x565183(0x1a3)](0x191)['json']({'error':_0x565183(0x196)});_0x45e438();};router[a0_0x407d76(0x191)](a0_0x407d76(0x19c),isAdmin,(_0x1f0684,_0x410909)=>{const _0x3ed1aa=a0_0x407d76;try{_0x410909[_0x3ed1aa(0x1d3)](path[_0x3ed1aa(0x206)](__dirname,_0x3ed1aa(0x223)));}catch(_0x15eac5){return handleError(_0x410909,_0x15eac5,_0x3ed1aa(0x192));}}),router[a0_0x407d76(0x191)](a0_0x407d76(0x1b7),isUserPage,(_0xc52dc0,_0x95504b)=>{const _0x11a825=a0_0x407d76;try{_0x95504b[_0x11a825(0x1d3)](path[_0x11a825(0x206)](__dirname,'user.html'));}catch(_0x584a82){return handleError(_0x95504b,_0x584a82,_0x11a825(0x1ca));}}),router[a0_0x407d76(0x1c5)](a0_0x407d76(0x20c),(_0x390050,_0x3e17fc)=>{const _0x35ad86=a0_0x407d76;try{const _0x323df1=_0x390050['session']['user']?_0x390050[_0x35ad86(0x1d5)][_0x35ad86(0x215)][_0x35ad86(0x197)]:'Unknown\x20user';_0x390050[_0x35ad86(0x1d5)][_0x35ad86(0x205)](_0x12dddb=>{const _0x482533=_0x35ad86;if(_0x12dddb)return logger[_0x482533(0x1b2)](_0x482533(0x193)+_0x323df1),_0x3e17fc[_0x482533(0x1a3)](0x1f4)['json']({'error':'Logout\x20failed.'});return logger[_0x482533(0x1f5)](_0x482533(0x210)+_0x323df1),_0x3e17fc['status'](0xc8)[_0x482533(0x1bf)]({'message':'Logged\x20out\x20successfully.'});});}catch(_0x5c9f4e){return handleError(_0x3e17fc,_0x5c9f4e,'Error\x20logging\x20out');}}),router[a0_0x407d76(0x1c5)](a0_0x407d76(0x1d4),(_0x187825,_0x3fa0bf)=>{const _0x3fb698=a0_0x407d76;try{const {type:_0x272679,email:_0x42abe0,message:_0x26ae17,timestamp:_0xcad31f}=_0x187825[_0x3fb698(0x21b)];logger[_0x3fb698(0x1f3)]({'level':'info','message':_0x272679+_0x3fb698(0x216)+_0x42abe0+':\x20'+_0x26ae17,'timestamp':_0xcad31f}),console[_0x3fb698(0x1f3)](_0x3fb698(0x19a),_0x187825['body']),_0x3fa0bf['status'](0xc8)[_0x3fb698(0x1ab)](_0x3fb698(0x20a));}catch(_0x5c0d65){return handleError(_0x3fa0bf,_0x5c0d65,_0x3fb698(0x219));}}),router[a0_0x407d76(0x1c5)]('/log-error',(_0xba6934,_0x2eef8b)=>{const _0x23ab7a=a0_0x407d76;try{const {type:_0x383b5c,email:_0x13b581,message:_0x302384,timestamp:_0x4bce38}=_0xba6934[_0x23ab7a(0x21b)];logger[_0x23ab7a(0x1f3)]({'level':_0x23ab7a(0x1b2),'message':_0x383b5c+_0x23ab7a(0x216)+_0x13b581+':\x20'+_0x302384,'timestamp':_0x4bce38}),console['log'](_0x23ab7a(0x19a),_0xba6934[_0x23ab7a(0x21b)]),_0x2eef8b[_0x23ab7a(0x1a3)](0xc8)[_0x23ab7a(0x1ab)](_0x23ab7a(0x20a));}catch(_0x3f8533){return handleError(_0x2eef8b,_0x3f8533,_0x23ab7a(0x219));}});function checkSessionTimeout(_0x3129ba,_0x1620f4,_0x3d4ca3){const _0xb68a53=a0_0x407d76;try{if(_0x3129ba[_0xb68a53(0x1d5)][_0xb68a53(0x215)]){if(Date[_0xb68a53(0x1a9)]()-_0x3129ba['session'][_0xb68a53(0x1c0)]>0x7530)return _0x3129ba[_0xb68a53(0x1d5)]['destroy'](),logger[_0xb68a53(0x1f6)](_0xb68a53(0x198)),_0x1620f4[_0xb68a53(0x1a3)](0x191)[_0xb68a53(0x1bf)]({'error':_0xb68a53(0x21f)});else _0x3129ba['session'][_0xb68a53(0x1c0)]=Date[_0xb68a53(0x1a9)]();}_0x3d4ca3();}catch(_0x1bf9d8){return handleError(_0x1620f4,_0x1bf9d8,_0xb68a53(0x1af));}}function trackLoginAttempts(_0x3a4b68,_0x1ff787,_0x49e71b){const _0x2659a9=a0_0x407d76;try{const _0x15e5ce=_0x3a4b68['ip'];!_0x3a4b68[_0x2659a9(0x1d5)]['loginAttempts']&&(_0x3a4b68[_0x2659a9(0x1d5)]['loginAttempts']={});!_0x3a4b68['session'][_0x2659a9(0x1be)][_0x15e5ce]&&(_0x3a4b68['session']['loginAttempts'][_0x15e5ce]={'attempts':0x0,'lockUntil':null});const _0x57ecb8=_0x3a4b68[_0x2659a9(0x1d5)][_0x2659a9(0x1be)][_0x15e5ce];if(_0x57ecb8[_0x2659a9(0x21d)]&&_0x57ecb8[_0x2659a9(0x21d)]>Date[_0x2659a9(0x1a9)]())return logger[_0x2659a9(0x1f6)](_0x2659a9(0x1bc)+_0x15e5ce),_0x1ff787[_0x2659a9(0x1a3)](0x1ad)[_0x2659a9(0x1bf)]({'error':'Too\x20many\x20login\x20attempts.\x20Please\x20try\x20again\x20later.'});_0x49e71b();}catch(_0x3d7b44){return handleError(_0x1ff787,_0x3d7b44,'Error\x20tracking\x20login\x20attempts');}}function handleFailedLoginAttempt(_0x35b099,_0x4fa00e){const _0x41ece7=a0_0x407d76;try{const _0x55933b=_0x35b099['ip'],_0x37a3e7=_0x35b099[_0x41ece7(0x1d5)]['loginAttempts'][_0x55933b];_0x37a3e7[_0x41ece7(0x1cd)]+=0x1;if(_0x37a3e7[_0x41ece7(0x1cd)]>=0x3)return _0x37a3e7[_0x41ece7(0x21d)]=Date['now']()+0x7530,logger['warn'](_0x41ece7(0x1a4)+_0x55933b+'\x20locked\x20due\x20to\x20too\x20many\x20login\x20attempts'),_0x4fa00e['status'](0x1ad)[_0x41ece7(0x1bf)]({'error':'Too\x20many\x20login\x20attempts.\x20Please\x20try\x20again\x20later.'});else{const _0x527478=0x3-_0x37a3e7[_0x41ece7(0x1cd)];return _0x4fa00e[_0x41ece7(0x1a3)](0x191)['json']({'error':_0x41ece7(0x1ac)+_0x527478+_0x41ece7(0x1b3)});}}catch(_0x558615){return handleError(_0x4fa00e,_0x558615,_0x41ece7(0x1f8));}}router[a0_0x407d76(0x191)](a0_0x407d76(0x194),checkSessionTimeout,(_0x224ab9,_0x18213e)=>{const _0x4d4be5=a0_0x407d76;try{_0x224ab9[_0x4d4be5(0x1d5)]&&_0x224ab9[_0x4d4be5(0x1d5)][_0x4d4be5(0x215)]?_0x18213e[_0x4d4be5(0x1a3)](0xc8)['json']({'message':_0x4d4be5(0x201),'roles':_0x224ab9[_0x4d4be5(0x1d5)]['roles'],'userId':_0x224ab9[_0x4d4be5(0x1d5)][_0x4d4be5(0x215)]['id'],'userEmail':_0x224ab9[_0x4d4be5(0x1d5)][_0x4d4be5(0x215)][_0x4d4be5(0x197)]}):_0x18213e['status'](0x191)[_0x4d4be5(0x1bf)]({'error':'Session\x20expired.'});}catch(_0x419c2){return console[_0x4d4be5(0x1b2)](_0x4d4be5(0x1cc),_0x419c2),handleError(_0x18213e,_0x419c2,_0x4d4be5(0x21a));}});function a0_0x5674(_0x46ac9b,_0x513946){const _0x278a4e=a0_0x278a();return a0_0x5674=function(_0x56747e,_0x10540c){_0x56747e=_0x56747e-0x190;let _0x31e7c8=_0x278a4e[_0x56747e];return _0x31e7c8;},a0_0x5674(_0x46ac9b,_0x513946);}function validateSession(_0x498bda,_0x20087b,_0x428fc5){const _0x51134f=a0_0x407d76;try{const _0x4868f3=_0x498bda[_0x51134f(0x20e)],_0x14326c=_0x51134f(0x20b);db[_0x51134f(0x199)](_0x14326c,[_0x4868f3],(_0x58e7cf,_0x48a5b6)=>{const _0xa9b48=_0x51134f;if(_0x58e7cf||_0x48a5b6['length']===0x0)return _0x20087b[_0xa9b48(0x1a3)](0x191)[_0xa9b48(0x1bf)]({'error':_0xa9b48(0x1e2)});_0x428fc5();});}catch(_0x414e63){return handleError(_0x20087b,_0x414e63,'Error\x20validating\x20session');}}router['use'](validateSession);function renewSession(_0xdaa6aa,_0x1c7768,_0x4ab1d0){const _0x16779d=a0_0x407d76;try{const _0xf7128d=_0xdaa6aa[_0x16779d(0x20e)];_0xdaa6aa['session']['regenerate'](_0xb2e110=>{const _0x3d3cbd=_0x16779d;if(_0xb2e110)return _0x4ab1d0(_0xb2e110);const _0x2cf7f9=_0xdaa6aa[_0x3d3cbd(0x20e)];logger['info']('Renewed\x20session\x20from\x20'+_0xf7128d+_0x3d3cbd(0x224)+_0x2cf7f9),_0x4ab1d0();});}catch(_0x5945f2){return handleError(_0x1c7768,_0x5945f2,_0x16779d(0x21e));}}function a0_0x278a(){const _0x549f28=['Error\x20creating\x20post','./uploads','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x20posts.id,\x20posts.content,\x20posts.price,\x20posts.quantity,\x20posts.status,\x20posts.created_at,\x20users.full_name\x20as\x20username,\x20posts.user_id\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FROM\x20posts\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20JOIN\x20users\x20ON\x20posts.user_id\x20=\x20users.id\x0a\x20\x20\x20\x20\x20\x20\x20\x20','admin.html','\x20to\x20','3141UlqlnD','User\x20signed\x20up\x20successfully:\x20','get','Error\x20loading\x20admin\x20page','Error\x20destroying\x20session\x20for\x20user:\x20','/check-session','single','Unauthorized','email','Session\x20timed\x20out','query','log\x20data:','insertId','/admin.html','Error\x20fetching\x20session\x20ID','slice','INSERT\x20INTO\x20posts\x20(user_id,\x20content,\x20price,\x20quantity,\x20status,\x20created_at)\x20VALUES\x20(?,\x20?,\x20?,\x20?,\x20?,\x20NOW())','env','Error\x20logging\x20in.','Error\x20fetching\x20user\x20roles.','status','IP\x20','Error\x20signing\x20up.','./database','2781465CXTzuf','image/jpeg','now','util','send','Invalid\x20email\x20or\x20password.\x20You\x20have\x20','length','readFile','Error\x20checking\x20session\x20timeout','56xGVJey','1607858USFrcJ','error','\x20more\x20attempts.','/signup','Database\x20query\x20error','Error\x20assigning\x20user\x20role.','/user.html','10NDCrdX','Error\x20updating\x20post','message','stack','Too\x20many\x20login\x20attempts\x20from\x20IP:\x20','UPDATE\x20posts\x20SET\x20status\x20=\x20?\x20WHERE\x20id\x20=\x20?','loginAttempts','json','lastActivity','SELECT\x20full_name\x20as\x20username\x20FROM\x20users\x20WHERE\x20id\x20=\x20?','some','/posts/:id','Invalid\x20file\x20type.\x20Only\x20JPEG/PNG\x20images\x20allowed.','post','/session-id','DELETE\x20FROM\x20posts\x20WHERE\x20id\x20=\x20?','mime','ER_DUP_ENTRY','Error\x20loading\x20user\x20page','/posts','Session\x20Check\x20Error:','attempts','INSERT\x20INTO\x20sessions\x20(user_id,\x20session_id)\x20VALUES\x20(?,\x20?)','full_name','hash','password','username','sendFile','/log','session','File\x20is\x20required','Post\x20status\x20updated\x20successfully','INSERT\x20INTO\x20users\x20(full_name,\x20email,\x20phone_number,\x20password,\x20profile_picture)\x20VALUES\x20(?,?,?,?,?)','Post\x20created\x20by\x20','debug','bcrypt','Debug\x20mode\x20is\x20','4139608cILyHv','promises','name','Server\x20error.','Logged\x20in\x20successfully.','Invalid\x20session.','params','unlink','Router','path','User\x20logged\x20in\x20successfully:\x20','1960170usIYUT','admin','true','file','Passwords\x20do\x20not\x20match.','express','SELECT\x20id,\x20password,\x20full_name,\x20email\x20FROM\x20users\x20WHERE\x20email\x20=\x20?','31076LtzLHv','Forbidden.\x20Admin\x20access\x20required.','UPDATE\x20posts\x20SET\x20content\x20=\x20?,\x20price\x20=\x20?,\x20quantity\x20=\x20?,\x20status\x20=\x20?\x20WHERE\x20id\x20=\x20?','Error\x20inserting\x20session\x20ID.','log','Email\x20already\x20exists.','info','warn','roles','Error\x20handling\x20failed\x20login\x20attempt','put','Signup\x20attempt\x20with\x20existing\x20email:\x20','7910615MVpuvX','/update-post-status/:id','Post\x20created\x20successfully','indexOf','config','pfp','Session\x20active.','exports','code','image/png','destroy','join','Failed\x20to\x20hash\x20password.','crypto','7070UDnKpC','Log\x20received','SELECT\x20*\x20FROM\x20sessions\x20WHERE\x20session_id\x20=\x20?','/logout','SELECT\x20r.name\x20FROM\x20user_roles\x20ur\x20JOIN\x20roles\x20r\x20ON\x20ur.role_id\x20=\x20r.id\x20WHERE\x20ur.user_id\x20=\x20?','sessionID','includes','User\x20logged\x20out:\x20','Invalid\x20post\x20data','INSERT\x20INTO\x20user_roles\x20(user_id,\x20role_id)\x20VALUES\x20(?,\x20(SELECT\x20id\x20FROM\x20roles\x20WHERE\x20name\x20=\x20\x22user\x22))','compare','file-type','user','\x20-\x20','Please\x20enter\x20a\x20valid\x20email\x20address.','test','Error\x20logging\x20data','Error\x20checking\x20session','body','Post\x20updated\x20successfully','lockUntil','Error\x20renewing\x20session','Session\x20timed\x20out.\x20Please\x20log\x20in\x20again.'];a0_0x278a=function(){return _0x549f28;};return a0_0x278a();}router[a0_0x407d76(0x191)](a0_0x407d76(0x1c6),(_0x1a4431,_0x2c3b28)=>{const _0x446231=a0_0x407d76;try{_0x2c3b28[_0x446231(0x1bf)]({'sessionId':_0x1a4431[_0x446231(0x20e)]});}catch(_0x512dc6){return handleError(_0x2c3b28,_0x512dc6,_0x446231(0x19d));}}),module[a0_0x407d76(0x202)]=router;